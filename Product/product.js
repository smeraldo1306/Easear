var listItem = [
    {   id: 1,
        brand: 'Marshall',
        photo: '../assets/img/Products/Marshall/Motif-ANC.png',
        model: 'Marshal Motif A.N.C',
        price: 4990000,
        form: 'In-ear',
        isWireless: 'true',
        isGamingType: 'false',
        rate: 4,
        discount: 0.2
    },
    {   id: 2,
        brand: 'SONY',
        photo: '../assets/img/Products/SONY/XBA-N1AP.png',
        model: 'SONY XBA-N1AP',
        price: 4990000,
        form: 'In-ear',
        isWireless: 'false',
        isGamingType: 'false',
        rate: 3.9,
        discount: 0.25
    },
    {   id: 3,
        brand: 'Apple',
        photo: '../assets/img/Products/Apple/AirPods-Max.png',
        model: 'Apple AirPods Max',
        price: 13900000,
        form: 'Over-ear',
        isWireless: 'true',
        isGamingType: 'false',
        rate: 4.2,
        discount: 0.35
    },
    {   id: 4,
        brand: 'ASUS',
        photo: '../assets/img/Products/ASUS/ROG-Cetra-True-Wireless.png',
        model: 'ASUS ROG Cetra True Wireless',
        price: 1890000,
        form: 'In-ear',
        isWireless: 'true',
        isGamingType: 'true',
        rate: 4.9,
        discount: 0
    },
    {   id: 5,
        brand: 'JBL',
        photo: '../assets/img/Products/JBL/Quantum-400.png',
        model: 'JBL Quantum 400',
        price: 1990000,
        form: 'Over-ear',
        isWireless: 'false',
        isGamingType: 'true',
        rate: 4.5,
        discount: 0.15
    },
    {   id: 6,
        brand: 'JBL',
        photo: '../assets/img/Products/JBL/T500BT.png',
        model: 'JBL T500BT',
        price: 1090000,
        form: 'On-ear',
        isWireless: 'true',
        isGamingType: 'false',
        rate: 3.5,
        discount: 0.1
    },
    {   id: 7,
        brand: 'KZ',
        photo: '../assets/img/Products/KZ/EDX-Pro.png',
        model: 'KZ EDX Pro',
        price: 250000,
        form: 'In-ear',
        isWireless: 'false',
        isGamingType: 'false',
        rate: 2.5,
        discount: 0
    },
    {   id: 8,
        brand: 'Marshall',
        photo: '../assets/img/Products/Marshall/Minor-III.png',
        model: 'Marshall Minor III Black',
        price: 3290000,
        form: 'In-ear',
        isWireless: 'true',
        isGamingType: 'false',
        rate: 4.2,
        discount: 0
    },
    {   id: 9,
        brand: 'Apple',
        photo: '../assets/img/Products/Apple/EarPods-Lightning.png',
        model: 'Apple EarPods Lightning',
        price: 590000,
        form: 'In-ear',
        isWireless: 'false',
        isGamingType: 'false',
        rate: 4,
        discount: 0.15
    },
    {   id: 10,
        brand: 'SONY',
        photo: '../assets/img/Products/SONY/WH-XB910N.png',
        model: 'SONY WH-XB910N',
        price: 4590000,
        form: 'Over-ear',
        isWireless: 'true',
        isGamingType: 'false',
        rate: 4.6,
        discount: 0.3
    },
    {   id: 11,
        brand: 'ASUS',
        photo: '../assets/img/Products/ASUS/TUF-H3.png',
        model: 'ASUS TUF H3',
        price: 990000,
        form: 'Over-ear',
        isWireless: 'false',
        isGamingType: 'true',
        rate: 5,
        discount: 0.1
    },
    {   id: 12,
        brand: 'SONY',
        photo: '../assets/img/Products/SONY/MDR-1AM2.png',
        model: 'SONY MDR-1AM2',
        price: 6990000,
        form: 'Over-ear',
        isWireless: 'false',
        isGamingType: 'false',
        rate: 5,
        discount: 0.3
    },
    {   id: 13,
        brand: 'KZ',
        photo: '../assets/img/Products/KZ/ZSN-Pro-X.png',
        model: 'KZ ZSN Pro X',
        price: 490000,
        form: 'In-ear',
        isWireless: 'false',
        isGamingType: 'false',
        rate: 5,
        discount: 0
    },
    {   id: 14,
        brand: 'ASUS',
        photo: '../assets/img/Products/ASUS/ROG-Strix-Go.png',
        model: 'ASUS ROG Strix Go',
        price: 1990000,
        form: 'Over-ear',
        isWireless: 'false',
        isGamingType: 'true',
        rate: 4.1,
        discount: 0
    },
    {   id: 15,
        brand: 'Marshall',
        photo: '../assets/img/Products/Marshall/Major-IV.png',
        model: 'Marshall Major IV Brown',
        price: 3690000,
        form: 'On-ear',
        isWireless: 'true',
        isGamingType: 'false',
        rate: 4.7,
        discount: 0.15
    },
    {   id: 16,
        brand: 'Marshall',
        photo: '../assets/img/Products/Marshall/Mode-EQ.png',
        model: 'Marshall Mode EQ',
        price: 1990000,
        form: 'In-ear',
        isWireless: 'false',
        isGamingType: 'false',
        rate: 3.7,
        discount: 0.1
    },
    {   id: 17,
        brand: 'JBL',
        photo: '../assets/img/Products/JBL/Quantum-50.png',
        model: 'JBL Quantum 50',
        price: 690000,
        form: 'In-ear',
        isWireless: 'false',
        isGamingType: 'true',
        rate: 3.6,
        discount: 0
    },
    {   id: 18,
        brand: 'JBL',
        photo: '../assets/img/Products/JBL/T600BTNC.png',
        model: 'JBL T600BTNC',
        price: 1550000,
        form: 'On-ear',
        isWireless: 'true',
        isGamingType: 'false',
        rate: 5,
        discount: 0
    },
    {   id: 19,
        brand: 'Apple',
        photo: '../assets/img/Products/Apple/AirPods-Pro.png',
        model: 'Apple AirPods Pro',
        price: 7990000,
        form: 'In-ear',
        isWireless: 'true',
        isGamingType: 'false',
        rate: 4.3,
        discount: 0.25
    },
    {   id: 20,
        brand: 'SONY',
        photo: '../assets/img/Products/SONY/WI-C100.png',
        model: 'SONY WI-C100',
        price: 650000,
        form: 'In-ear',
        isWireless: 'true',
        isGamingType: 'false',
        rate: 4.4,
        discount: 0
    },
    {   id: 21,
        brand: 'Marshall',
        photo: '../assets/img/Products/Marshall/Monitor-II-ANC.png',
        model: 'Marshall Monitor II A.N.C',
        price: 3190000,
        form: 'In-ear',
        isWireless: 'true',
        isGamingType: 'false',
        rate: 3.2,
        discount: 0.1
    },
    {   id: 22,
        brand: 'ASUS',
        photo: '../assets/img/Products/ASUS/ROG-Cetra-2-Core.png',
        model: 'ASUS ROG Cetra 2 Core',
        price: 1290000,
        form: 'In-ear',
        isWireless: 'false',
        isGamingType: 'false',
        rate: 4.8,
        discount: 0.1
    },
    {   id: 23,
        brand: 'SONY',
        photo: '../assets/img/Products/SONY/MDR-ZX110AP.png',
        model: 'SONY MDR-ZX110AP',
        price: 540000,
        form: 'On-ear',
        isWireless: 'false',
        isGamingType: 'false',
        rate: 3.9,
        discount: 0
    },
]
var isLogin = localStorage.getItem("isLogin");

const filter = document.querySelector(".filter")
const filterForm = document.querySelector(".filter form");
const filterBtnClose = document.querySelector(".filter .btn-close");
const filterBtnCancel = document.querySelector(".filter .filter-btn-cancel");
const filterBtnApply = document.querySelector(".filter .filter-btn-apply");
const clearFilterBtn = document.querySelector(".filter .clear-filter-btn");
const allProductItem = document.querySelector(".all-product .product-item-list");
const filterResultTitle = document.querySelector(".all-product h2");
const countDown = document.querySelector(".flash-sale .count-time");
const flashSaleList = document.querySelector(".flash-sale .flash-sale-list");

//Dếm ngược flash sale
function CountDownTimer() {
    var countDownDate = new Date("Dec 14, 2022 00:00:00").getTime();
    var x = setInterval(function() {
    var now = new Date().getTime();
    var distance = countDownDate - now;
    var days = Math.floor(distance / (1000 * 60 * 60 * 24));
    var hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
    var minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
    var seconds = Math.floor((distance % (1000 * 60)) / 1000);
        
    countDown.innerHTML = "Kết thúc sau " + days + "d " + hours + "h " + minutes + "m " + seconds + "s";
        
    if (distance < 0) {
        clearInterval(x);
        countDown.innerHTML = "Đã kết thúc";
    }
    }, 1000);
}
CountDownTimer();
    
// Hiển thị các sản phẩm mặc định khi trang reload
function showItemDefault() {
    filterResultTitle.innerHTML = `Tất cả sản phẩm (${listItem.length})`;
    flashSaleList.innerHTML = '';
    allProductItem.innerHTML = '';

    for(let i = 0; i < listItem.length; i++) {
        brand = listItem[i].brand;
        photo = listItem[i].photo;
        model = listItem[i].model;
        price = listItem[i].price;
        form = listItem[i].form;
        isWireless = listItem[i].isWireless;
        isGamingType = listItem[i].isGamingType;
        rate = listItem[i].rate;
        discount = listItem[i].discount;
        newPrice = new Intl.NumberFormat('vi-VN', { style: 'currency', currency: 'VND' }).format(price * (1 - discount));

        if(discount > 0) {
            flashSaleList.innerHTML += `
            <div class="flash-sale-item">
                <p class="id" id="${i}" style="display: none;"></p>
                <img src="${photo}" alt="">
                <h5 class="model">${model}</h5>
                <p class="d-flex align-items-center">${rate}
                    <img src="../assets/img/star-rate.png" class="star-rate">
                </p>
                <div class="d-flex justify-content-start">
                    <h5 class="price">${newPrice}</h5>
                    <p class="text-decoration-line-through ms-2">${new Intl.NumberFormat('vi-VN', { style: 'currency', currency: 'VND' }).format(listItem[i].price)}</p>
                </div>
                <div class="percent-discount"><p>-${new Intl.NumberFormat('en-US', {style: 'percent'}).format(discount)}</p></div>
                <form action="" class="add-to-cart-form" id="liveToastBtn">
                    <button type="button" class="btn btn-outline-dark add-to-cart-btn">Thêm vào giỏ hàng</button>
                </form>
            </div>
            `;
        }

        allProductItem.innerHTML += `
        <div class="product-item-container col-6 col-sm-4 col-md-3 col-lg-2">
            <div class="product-item p-2" id="${i}">
                <img src="${photo}" alt="">
                <h5 class="m-0 mt-2">${model}</h5>
                <p class="m-0 mt-2 d-flex align-items-center">${rate}
                    <img src="../assets/img/star-rate.png" class="star-rate">
                </p>
                <h5 class="m-0 mt-2">${new Intl.NumberFormat('vi-VN', { style: 'currency', currency: 'VND' }).format(price)}</h5>
            </div>
        </div>
        `;

    }
};
showItemDefault();

// Cuộn ngang danh sách flash sale
flashSaleList.addEventListener("wheel", function(e) {
    e.preventDefault();
    flashSaleList.scrollLeft += 0.4 * e.deltaY;
});

// Lưu thông tin sản phẩm vào session storage để đưa vào trang chi tiết
function renderDetailPage() {
    var productItems = allProductItem.querySelectorAll(".product-item-container .product-item");
    productItems.forEach(function(item) {
        item.addEventListener("click", function() {
            var itemClicked = item.id;
            sessionStorage.setItem("Clicked", itemClicked);
            window.open("../Product Detail/productDetail.html", '_blank');
        });
    });
}
renderDetailPage();

// Lọc sản phẩm
filterForm.addEventListener("submit", (e) => {
    e.preventDefault();
})

clearFilterBtn.addEventListener("click", function() {
    showItemDefault();
    filterBtnClose.click();
    window.location.reload();
})
// Xử lí lọc
function filterSelected() {
    //Select by category (form)
    var categoryCheckboxForm = document.querySelectorAll(".filter .category-checkbox-type");
    var categoryTypeSelected = [];
    for(let i = 0; i < categoryCheckboxForm.length; i++) {
        if(categoryCheckboxForm[i].checked == true) {
            categoryTypeSelected.push(categoryCheckboxForm[i].value);
        }
    }

    //Select by category (wireless)
    var categoryCheckboxConnection = document.querySelectorAll(".filter .category-checkbox-connection");
    var categoryConnectionSelected = [];
    for(let i = 0; i < categoryCheckboxConnection.length; i++) {
        if(categoryCheckboxConnection[i].checked == true) {
            categoryConnectionSelected.push(categoryCheckboxConnection[i].value);
        }
    }

    //Select by category (gaming)
    var categoryCheckboxGaming = document.querySelectorAll(".filter .category-checkbox-gaming");
    var categoryGamingSelected = [];
    for(let i = 0; i < categoryCheckboxGaming.length; i++) {
        if(categoryCheckboxGaming[i].checked == true) {
            categoryGamingSelected.push(categoryCheckboxGaming[i].value);
        }
    }

    //Select by brand
    var brandCheckbox = document.querySelectorAll(".filter .brand-checkbox");
    var brandSelected = [];
    for(let i = 0; i < brandCheckbox.length; i++) {
        if(brandCheckbox[i].checked == true) {
            brandSelected.push(brandCheckbox[i].value);
        }
    }

    //Selected by price
    var priceCheckbox = document.querySelectorAll(".filter .price-checkbox");
    var priceSelected = [];
    for(let i = 0; i < priceCheckbox.length; i++) {
        if(priceCheckbox[i].checked == true) {
            priceSelected.push(priceCheckbox[i].value);
        }
    }

    //Select by rate
    var rateCheckRadio = document.querySelectorAll(".filter .rate-check-radio");
    var rateSelected = '0';
    for(let i = 0; i < rateCheckRadio.length; i++) {
        if(rateCheckRadio[i].checked == true) {
            rateSelected = rateCheckRadio[i].value;
        }
    }

    showItem(categoryTypeSelected, categoryConnectionSelected, categoryGamingSelected, brandSelected, priceSelected, rateSelected);
}

// Hiển thị sản phẩm sau khi lọc
function showItem(categoryTypeSelected=[], categoryConnectionSelected=[], categoryGamingSelected=[], brandSelected=[], priceSelected=[], rateSelected) {
    var numberOfItems = 0;
    filterResultTitle.innerHTML = `Số sản phẩm (0)`;
    allProductItem.innerHTML = '';

    for(let i = 0; i < listItem.length; i++) {
        brand = listItem[i].brand;
        photo = listItem[i].photo;
        model = listItem[i].model;
        price = listItem[i].price;
        form = listItem[i].form;
        isWireless = listItem[i].isWireless;
        isGamingType = listItem[i].isGamingType;
        rate = listItem[i].rate;

        if(categoryTypeSelected.length > 0) {
            if(categoryTypeSelected.includes(form) == false) continue;
        }

        if(categoryConnectionSelected.length > 0) {
            if(categoryConnectionSelected.includes(isWireless) == false) continue;
        }

        if(categoryGamingSelected.length > 0) {
            if(categoryGamingSelected.includes(isGamingType) == false) continue;
        }

        if(brandSelected.length > 0) {
            if(brandSelected.includes(brand) == false) continue;
        }

        if(priceSelected.length > 0) {
            if(price < 1000000 && priceSelected.includes('1') == false) continue;
            if((price >= 1000000 && price < 3000000) && priceSelected.includes('2') == false) continue;
            if((price >= 3000000 && price < 5000000) && priceSelected.includes('3') == false) continue;
            if((price >= 5000000 && price < 10000000) && priceSelected.includes('4') == false) continue;
            if(price >= 10000000 && priceSelected.includes('5') == false) continue;
        }

        if(rateSelected !== '0') {
            if(rateSelected === '5' && rate != 5) continue;
            if(rateSelected === '4' && rate < 4) continue;
            if(rateSelected === '3' && (rate < 3 || rate > 4)) continue;
            if(rateSelected === '2' && (rate < 2 || rate > 3)) continue;
            if(rateSelected === '1' && (rate < 1 || rate > 2)) continue;
        };

        allProductItem.innerHTML += `
        <div class="product-item-container col-6 col-sm-4 col-md-3 col-lg-2">
            <div class="product-item p-2" id="${i}">
                <img src="${photo}" alt="">
                <h5 class="m-0 mt-2">${model}</h5>
                <p class="m-0 mt-2 d-flex align-items-center">${rate}
                    <img src="../assets/img/star-rate.png" class="star-rate">
                </p>
                <h5 class="m-0 mt-2">${new Intl.NumberFormat('vi-VN', { style: 'currency', currency: 'VND' }).format(listItem[i].price)}</h5>
            </div>
        </div>
        `;
        numberOfItems++;
        filterResultTitle.innerHTML = `Số sản phẩm (${numberOfItems})`;
    }
}

filterBtnCancel.addEventListener("click", function() {
    filterBtnClose.click();
})

filterBtnApply.addEventListener("click", function() {
    filterSelected();
    filterBtnClose.click();
    renderDetailPage();
})

// Lưu thông tin sản phẩm vào storage để đưa vào giỏ hàng
var itemSelected = {
    "index": "",
    "photo": "",
    "model": "",
    "price": "",
    "amount": ""
}
const addToCartForm = document.querySelectorAll(".add-to-cart-form");
const liveToast = document.getElementById('liveToast');
const toastBody = liveToast.querySelector(".toast-body");
addToCartForm.forEach((form) => {
        form.addEventListener("click", function() {
            if(isLogin == "true") {
                key = form.parentElement.querySelector(".id").id;
                itemSelected.index = key;
                itemSelected.photo = form.parentElement.querySelector("img").src;
                itemSelected.model = form.parentElement.querySelector(".model").innerText;
                itemSelected.price = form.parentElement.querySelector(".price").innerText;
                var currentAmount = JSON.parse(localStorage.getItem(key));
                if(currentAmount === null) {
                    itemSelected.amount = 1;
                }
                else {
                    itemSelected.amount = currentAmount.amount + 1;
                }
                localStorage.setItem(key, JSON.stringify(itemSelected));
                const toast = new bootstrap.Toast(liveToast);
                liveToast.style.border = "1px solid green";
                liveToast.style.background = "rgba(209, 231, 221, 0.9)";
                toastBody.innerHTML = `<p>Thêm thành công sản phẩm ${itemSelected.model} vào giỏ hàng</p>`
                toast.show();

            }
            else {
                const toast = new bootstrap.Toast(liveToast);
                liveToast.style.border = "1px solid red";
                liveToast.style.background = "rgba(244, 193, 193, 0.9)";
                toastBody.innerHTML = `<p>Bạn chưa đăng nhập. Vui lòng đăng nhập để tiếp tục.</p>`
                toast.show();
            }

            
        })
    }
)















